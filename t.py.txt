def transpose_data(df, key, var, prefix):
    # Select only the key and variable columns, similar to the "keep" statement in SAS
    temp_df = df[[key, var]].copy()
    
    # Pivot the data, similar to the SAS PROC TRANSPOSE with BY key
    # We use pivot_table with an aggregation to handle duplicate values.
    transposed = temp_df.pivot_table(index=key, columns=var, aggfunc='first').reset_index()
    
    # Rename the columns to match the SAS prefix approach
    transposed.columns = [f"{prefix}_{col}" if col != key else col for col in transposed.columns]
    
    return transposed
