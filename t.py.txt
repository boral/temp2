import re

def asIdentifier(id):
    # Makes a valid identifier from a string
    # Detailed explanation goes here
    id = re.sub('\W|^(?=\d)', '_', id)
    return id

import numpy as np

def getAllocArray(mapping, facIDs, secIDs):
    # Calculate the allocation table between facilities and securities
    # TO DO: This now accept input data with facilities, we must ensure that the
    # order of securities in returned array make sense
    # TO DO: Check how this will behave for a case with facility to which no
    # securities are allocated.

    allocArray = np.zeros((len(facIDs), len(secIDs)), dtype=bool)
    mappingFacilities = list(mapping.keys())
    facIDs = asIdentifier(facIDs)

    for iRow in range(len(mappingFacilities)):
        fID = mappingFacilities[iRow]
        row = np.where(facIDs == fID)[0]
        sIDs = mapping[fID]
        for iSec in range(len(sIDs)):
            col = np.where(secIDs == sIDs[iSec])[0]
            allocArray[row, col] = True

    aa = FlowValueHolder(allocArray)
    return aa
