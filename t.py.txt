# Load rating data
apl_grade = pd.read_csv('corp_psf/apl_grade_combined_15MAR2024.csv')

# Check initial counts
initial_count = len(apl_grade)
distinct_gcdu_global_id_count = len(apl_grade['gcdu_global_id'].unique())

# Filter rating data
apl_grade = apl_grade[apl_grade['approval_date'].notnull() &
                      apl_grade['GCDU_GLOBAL_ID'].notnull() &
                      (apl_grade['APPLICATION_TYPE_CODE'] != "CN") &
                      (apl_grade['APPLICATION_STATUS_CODE'] == "A")]

# Identify model gids
apl_grade_model_gid = identify_model_gid(apl=apl_grade, model=model)

# Initial count of model gids
initial_model_gid_count = len(apl_grade_model_gid['gcdu_global_id'].unique())

# Add private equity gids (for HF only)
if model == "HF":
    # Load private equity gids
    pvt_gid = load_pvt_data(pveq_path=pveq_path, pvdt_path=pvdt_path, 
                             pvcr_path=pvcr_path, capc_path=capc_path)

    # Add private equity gids to model gids
    apl_grade_model_gid = pd.concat([apl_grade_model_gid, pvt_gid]).drop_duplicates(subset='gcdu_global_id')

# Revised count of model gids
revised_model_gid_count = len(apl_grade_model_gid['gcdu_global_id'].unique())

# Extract apl data for model gids
apl_grade_model_all = apl_grade[apl_grade['GCDU_GLOBAL_ID'].isin(apl_grade_model_gid['GCDU_GLOBAL_ID'])]

# Count of gids with rating data
count_with_rating_data = len(apl_grade_model_all['gcdu_global_id'].unique())
